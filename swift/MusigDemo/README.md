# Overview

This is an example of using musig as an aar package. Some help for building a threshold signature wallet for Ios.

# Dependencies

Import package

`File>Add Packages>Github` search https://github.com/AAweidai/Musig, as shown in the figure below. The current version is **1.4.0**.

![](https://cdn.jsdelivr.net/gh/AAweidai/PictureBed@master/taproot/16329983286771632998328618.png)

Step 2. Import
```
import Musig
```

# Api
Class: Musig(private)
```
Pass in the 32-byte private key string to create the Musig class for multi-signature.
```
- Musig.getMyPubkey()
```java
Returns: <String>
Return a 32-byte public key string.
Possible error string returned is `Invalid Secret Bytes`.
```
- Musig.getMyReveal()
```java
Pass in the commits and public-keys of other signers.
Returns: <String>
Returns a 96-byte reveal string.
Possible error strings returned are `Null Musig` or `Invalid Reveal Bytes`.
```
- Musig.getMyCosign([reveals], [pubkeys])
```java
Pass in the reveals and public-keys of other signers.
Returns: <String>
Returns a 32-byte cosign string.
Possible error strings returned are `Null Musig` or `Invalid Cosign Bytes`.
```
- getAggSignature([reveals], [pubkeys], [cosigns])
```java
Pass in the reveals, public-keys and cosigns of other signers.
Returns: <String>
Returns a 64-byte signature string.
Possible error string returned is `Invalid Signature`.
```
- getAggPublicKey([pubkeys])
```java
Pass in the public-keys to be aggregated.
Returns: <String>
Returns a 32-byte aggregate public-key string.
Possible error strings returned are `Null Musig` or `Invalid Commit Bytes`.
```

### Class: Mast(pubkeys, threshold)

```
Pass in the public keys of all signers and the thresholds of their signatures to construct the mast.
```
- Mast.generateThresholdPubkey()
```java
Returns: <String>
Return the public key of the threshold-signature address.
Possible error string returned is `Invalid Public Bytes`.
```
- Mast.generateControlBlock(aggPubkey)
```java
Need to pass in the aggregated signatures of the signers.
Returns: <String>
Return signed proofs for transaction validation.
Possible error string returned is `Invalid Public Bytes`.
```

# Example

The specific usage can be viewed in [ViewController.swift](MusigDemo/ViewController.swift).This example simulates three people generating aggregated public keys and aggregated signatures firstly. Then including Mast address generation and control block generation.

## Details

## Musig

- First pass in the private key to declare a Musig instance

~~~swift
let musig0 = Musig(priv: private0)
~~~

- Use Musig instance to get my own public key and reveal.

~~~swift
let pubkey0 = musig0.getMyPubkey()
let reveal0 = musig0.getMyReveal()
~~~

- Pass the self-generated pubkey and reveal to the other two parties, and the other two parties do the same. In the end, I got the public key and reveal of the other two parties. Pass in the `getMyCosign` function to generate my own cosign. **Note that when passing parameters here, pubkey and reveal must correspond one to one**.

~~~swift
let cosign0 = musig0.getMyCosign(reveals: [reveal1, reveal2], pubkeys: [pubkey1, pubkey2])
~~~

- Like commit, pass the cosign and pubkey generated by myself to the other two parties, and I can finally generate the signature by `getAggSignature`. **Note that when passing parameters here, reveal, pubkey and reveal must correspond one to one**.

~~~swift
let signature = getAggSignature(reveals: [reveal0, reveal1, reveal2], cosigns: [cosign0, cosign1, cosign2], pubkeys: [pubkey0, pubkey1, pubkey2])
~~~

- When I obtain the public keys of the other two parties, I can generate the aggregate public key. **Note that the public key here must be in order, and the incoming order of the `getAggSignature` must be consistent.**

~~~swift
let pubkey = getAggPublicKey(pubkeys: [pubkey0, pubkey1, pubkey2])
~~~

## Mast

- The threshold signature address can be generated by using the threshold and the public key of the all participant.

~~~swift
let threshold_pubkey = generateThresholdPubkey(pubkeys: [pubkeya, pubkeyb, pubkeyc], threshold: 2);
~~~

- Using the threshold, the public keys of all participants and the aggregation of the public keys can generate a proof.

~~~swift
let control_block = generateControlBlock(pubkeys: [pubkeya, pubkeyb, pubkeyc], threshold: 2, agg_pubkey: pubkeyab)
~~~





